---
title: "Merge actigraph and fitbit"
format: html
editor: visual
---

# Actigraph and fitbit data merging

```{r}
library(tidyverse)
library(anytime)
```

## Read data

### Read Actigraph data

```{r day summary}
df_actigraph <- read.csv("input/part2_daysummary_longformat.csv") |>
  filter(
    qwindow_name == "0-24hr"
  ) |>
  mutate(Date = anydate(calendar_date)) |> 
  select(ID, Date, step_count_sum) |> 
  mutate(ID = str_extract(ID, "^[A-Z]{2}-\\d{1,3}-\\d{1,3}"))
```

```{r hourly data}
# this is currently not used
df_hourly <- read.csv("input/VALIDATION_intraday_per_hour.csv")
```

### Read Fitbit data

```{r daily data}
df_daily <- read.csv("input/VALIDATION_daily_steps_hr.csv") |> rename(
  ID = study.number
) |> 
  mutate(
    Date = anydate(Date)
  )
```

## Join fitbit and actigraph data

### Daily data

```{r join daily data}
df_merged <- left_join(
  df_actigraph,
  df_daily,
  by = c("Date", "ID")
) |> 
  select(
    ID, Date, step_count_sum, value.steps
  )

write.csv(df_merged, "output/joined_daily.csv")
```

### Hourly data

So far, we don't have the data yet for the hourly data. However, the procedure should be pretty similar to what we do for the summary data.
